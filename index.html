<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cosmoteer ‚Äì Minimal vs AI</title>
<style>
  :root {
    --bg:#0e0f14; --panel:#151823; --card:#1c2030; --accent:#6ee7ff; --accent2:#ffd166;
    --good:#4ade80; --bad:#f87171; --muted:#94a3b8; --text:#e6edf3;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0e0f14,#0c101a 40%,#0a0f18);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
  header{padding:12px 16px;border-bottom:1px solid #1f2433;background:#0e121b;position:sticky;top:0;z-index:2}
  header h1{margin:0;font-size:18px;font-weight:600;letter-spacing:.3px}
  main{max-width:980px;margin:0 auto;padding:16px;display:grid;gap:12px}
  .row{display:grid;grid-template-columns:1fr 280px;gap:12px}
  .arena{background:var(--panel);border:1px solid #22283a;border-radius:10px;padding:12px;display:grid;gap:12px}
  .cols{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .side h3{margin:0 0 6px 0;font-size:14px;color:var(--muted);font-weight:600}
  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px}
  .card{background:var(--card);border:1px solid #283147;border-radius:10px;padding:10px;display:grid;gap:8px;position:relative;min-height:110px}
  .title{display:flex;align-items:center;gap:6px;font-weight:700}
  .hpbar{height:8px;background:#2a3348;border-radius:999px;overflow:hidden}
  .hpbar>div{height:100%;background:linear-gradient(90deg,var(--good),#22c55e);width:100%}
  .meta{font-size:12px;color:var(--muted);display:flex;gap:8px;flex-wrap:wrap}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  button{appearance:none;background:#1f2638;color:var(--text);border:1px solid #2b3550;border-radius:8px;padding:8px 10px;font-weight:600;cursor:pointer}
  button:hover{border-color:#3b4a73}
  button:disabled{opacity:.45;cursor:not-allowed}
  .pill{display:inline-flex;align-items:center;gap:6px;background:#1a2233;border:1px solid #27314a;border-radius:999px;padding:4px 8px;font-size:12px}
  .shieldOn{color:#cffafe}
  .shieldOff{color:#94a3b8;text-decoration:line-through}
  aside{background:var(--panel);border:1px solid #22283a;border-radius:10px;padding:12px;display:grid;gap:10px;height:fit-content;position:sticky;top:64px}
  .log{background:#0f1420;border:1px solid #1e2740;border-radius:8px;min-height:160px;max-height:320px;overflow:auto;padding:8px;font-family:ui-monospace,Consolas,monospace;font-size:12px;line-height:1.4}
  .row2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .toast{padding:8px 10px;background:#111829;border:1px solid #203052;border-radius:8px}
  .you{border-left:4px solid var(--accent);padding-left:8px}
  .ai{border-left:4px solid var(--accent2);padding-left:8px}
  footer{padding:12px 16px;color:#94a3b8;text-align:center}
</style>
</head>
<body>
<header><h1>Cosmoteer (Minimal) ‚Äî Human vs AI</h1></header>
<main>
  <div class="row">
    <section class="arena">
      <div class="row2">
        <div class="toast you" id="turnLabel">Your turn</div>
        <div class="toast">Round <span id="roundNum">1</span> ‚Ä¢ Modifier Deck: <span id="deckLeft">‚àû</span></div>
      </div>
      <div class="cols">
        <div class="side" id="youSide">
          <h3>üßë Your Ship</h3>
          <div class="cards" id="youCards"></div>
        </div>
        <div class="side" id="aiSide">
          <h3>ü§ñ AI Ship</h3>
          <div class="cards" id="aiCards"></div>
        </div>
      </div>
    </section>
    <aside>
      <div class="row2">
        <button id="endTurnBtn">End Turn</button>
        <button id="newRoundBtn">New Round</button>
      </div>
      <button id="resetBtn">Reset Game</button>
      <div class="log" id="log"></div>
    </aside>
  </div>
  <section class="toast">
    <b>How to play (minimal rules)</b><br/>
    ‚Ä¢ You and the AI each have: Core (‚ù§Ô∏è5), Laser (üí•2), Shield (üõ°Ô∏è2 once/round).<br/>
    ‚Ä¢ On your turn, pick an enemy module to attack with your Laser. A modifier is drawn (Hit‚ûï1, Miss, Crit√ó2, Null).<br/>
    ‚Ä¢ The defender‚Äôs Shield (if unused this round) blocks up to 2 damage automatically, once per round.<br/>
    ‚Ä¢ Destroy the enemy Core to win. New Round refreshes shields on both sides.
  </section>
</main>
<footer>Config & AI are tweakable in the script block below.</footer>

<script>
/* ==============================
   CONFIG (tweak freely)
============================== */
const CONFIG = {
  startingRound: 1,
  playerFirst: true,
  modules: {
    core:   { name:"Core", emoji:"‚ù§Ô∏è", hp:5, type:"Core" },
    laser:  { name:"Laser", emoji:"üí•", dmg:2, hp:3, type:"Weapon" },
    shield: { name:"Shield", emoji:"üõ°Ô∏è", block:2, hp:2, type:"Defense", oncePerRound:true },
  },
  // Minimal modifier deck (infinite shuffle model)
  // weights sum to 1.0
  modifiers: [
    { name:"Hit‚ûï1",  short:"+1",  effect:"plus1",  weight:0.35 },
    { name:"Crit√ó2",  short:"√ó2",  effect:"crit",   weight:0.20 },
    { name:"Null",    short:"‚Äì",   effect:"null",   weight:0.25 },
    { name:"Miss",    short:"0",   effect:"miss",   weight:0.20 }
  ],
  // AI target priority: weapon -> shield -> core
  aiPriority: ["Weapon","Defense","Core"],
  betweenTurnsDelayMs: 450
};

/* ==============================
   State
============================== */
const state = {
  round: CONFIG.startingRound,
  turn: CONFIG.playerFirst ? "you" : "ai",
  you: null,
  ai: null,
  shieldsUsed: { you:false, ai:false },
};

function makeShip() {
  return [
    // Core (must exist)
    { id: uid(), key:"core",   name: CONFIG.modules.core.name,   type: CONFIG.modules.core.type,   emoji:CONFIG.modules.core.emoji, maxHp: CONFIG.modules.core.hp, hp: CONFIG.modules.core.hp, alive:true },
    // Weapon
    { id: uid(), key:"laser",  name: CONFIG.modules.laser.name,  type: CONFIG.modules.laser.type,  emoji:CONFIG.modules.laser.emoji, dmg: CONFIG.modules.laser.dmg, maxHp: CONFIG.modules.laser.hp, hp: CONFIG.modules.laser.hp, alive:true },
    // Shield
    { id: uid(), key:"shield", name: CONFIG.modules.shield.name, type: CONFIG.modules.shield.type, emoji:CONFIG.modules.shield.emoji, block:CONFIG.modules.shield.block, oncePerRound:true, maxHp: CONFIG.modules.shield.hp, hp: CONFIG.modules.shield.hp, alive:true }
  ];
}

function resetGame() {
  state.round = CONFIG.startingRound;
  state.turn = CONFIG.playerFirst ? "you" : "ai";
  state.you = makeShip();
  state.ai  = makeShip();
  state.shieldsUsed = { you:false, ai:false };
  clearLog();
  log(`Game reset. Round ${state.round}. ${state.turn === "you" ? "You begin." : "AI begins."}`);
  renderAll();
  if (state.turn === "ai") aiTurn();
}

/* ==============================
   Rendering
============================== */
function renderAll() {
  $("#roundNum").textContent = state.round;
  $("#turnLabel").textContent = state.turn === "you" ? "Your turn" : "AI thinking‚Ä¶";
  $("#turnLabel").className = "toast " + (state.turn === "you" ? "you" : "ai");
  renderSide("you");
  renderSide("ai");
  $("#endTurnBtn").disabled = (state.turn !== "you");
}

function renderSide(side) {
  const holder = side === "you" ? $("#youCards") : $("#aiCards");
  holder.innerHTML = "";
  const ship = state[side];

  for (const m of ship) {
    const card = el("div","card");
    const title = el("div","title", `${m.emoji} ${m.name}`);
    const meta  = el("div","meta");
    const hpbar = el("div","hpbar");
    const hpfill= el("div","");
    hpfill.style.width = Math.max(0, (m.hp/m.maxHp)*100) + "%";
    hpbar.appendChild(hpfill);

    // Status pills
    meta.appendChild(pill(`${m.type}`));
    meta.appendChild(pill(`HP ${m.hp}/${m.maxHp}`));

    if (m.type === "Weapon") meta.appendChild(pill(`DMG ${m.dmg}`));
    if (m.key === "shield") {
      const used = state.shieldsUsed[side];
      const cls = used ? "pill shieldOff" : "pill shieldOn";
      meta.appendChild(el("span", cls, used ? "Shield used" : `üõ°Ô∏è${m.block} ready`));
    }

    // Controls (only for player's view / when player's turn)
    const controls = el("div","controls");
    if (state.turn === "you" && side === "ai" && alive(m)) {
      const btn = el("button","",`Attack ${m.name}`);
      btn.onclick = () => playerAttack(m.id);
      // require your weapon alive
      if (!getModule(state.you,"laser").alive || !alive(m)) btn.disabled = true;
      controls.appendChild(btn);
    }

    card.appendChild(title);
    card.appendChild(meta);
    card.appendChild(hpbar);
    if (controls.children.length) card.appendChild(controls);

    // dead overlay?
    if (!alive(m)) {
      card.style.opacity = .55;
      card.style.filter = "grayscale(0.5)";
      card.appendChild(el("div","meta", "Destroyed"));
    }

    holder.appendChild(card);
  }
}

/* ==============================
   Turn / Combat
============================== */
function playerAttack(targetId) {
  if (state.turn !== "you") return;
  const yourLaser = getModule(state.you,"laser");
  if (!yourLaser.alive) { log("‚ùå Your Laser is destroyed.", "warn"); return; }

  const target = state.ai.find(m=>m.id===targetId);
  if (!target || !alive(target)) { log("‚ùå Invalid target.", "warn"); return; }

  const base = yourLaser.dmg;
  const mod  = drawModifier();
  const dmg  = computeDamage(base, mod, state.shieldsUsed.ai, /*defenderHasShield*/ getModule(state.ai,"shield").alive);

  applyDamage(target, dmg.applied);
  if (dmg.shieldConsumed) state.shieldsUsed.ai = true;

  log(`üßë fires Laser at AI ${target.name} for base ${base}. Mod: ${mod.name} ‚áí ${dmg.final} raw, ${dmg.applied} applied${dmg.shieldConsumed ? " (üõ°Ô∏è absorbed up to 2)" : ""}.`);

  renderAll();
  const win = checkWin();
  if (win) return;

  endTurnTo("ai");
  setTimeout(aiTurn, CONFIG.betweenTurnsDelayMs);
}

function aiTurn() {
  if (state.turn !== "ai") return;

  const aiLaser = getModule(state.ai,"laser");
  if (!aiLaser.alive) {
    log("ü§ñ AI‚Äôs Laser is destroyed; AI skips attack.");
    endTurnTo("you");
    return;
  }

  // choose best target: weapon -> shield -> core (alive)
  const target = chooseAiTarget();
  const base = aiLaser.dmg;
  const mod  = drawModifier();
  const dmg  = computeDamage(base, mod, state.shieldsUsed.you, /*defenderHasShield*/ getModule(state.you,"shield").alive);

  applyDamage(target, dmg.applied);
  if (dmg.shieldConsumed) state.shieldsUsed.you = true;

  log(`ü§ñ AI fires Laser at your ${target.name} for base ${base}. Mod: ${mod.name} ‚áí ${dmg.final} raw, ${dmg.applied} applied${dmg.shieldConsumed ? " (üõ°Ô∏è absorbed up to 2)" : ""}.`);

  renderAll();
  const win = checkWin();
  if (win) return;

  endTurnTo("you");
}

function endTurnTo(who) {
  state.turn = who;
  renderAll();
}

function newRound() {
  state.round += 1;
  state.shieldsUsed = { you:false, ai:false };
  log(`üîÅ New round. Shields refreshed.`);
  renderAll();
}

function checkWin() {
  const youCore = getModule(state.you,"core");
  const aiCore  = getModule(state.ai,"core");
  if (!aiCore.alive) { log("üèÜ You destroyed the AI Core. You win!"); lockControls(); return true; }
  if (!youCore.alive){ log("üí• Your Core was destroyed. AI wins."); lockControls(); return true; }
  return false;
}

function lockControls() {
  $("#endTurnBtn").disabled = true;
}

/* ==============================
   Damage / Modifiers
============================== */
function drawModifier() {
  // weighted random
  const r = Math.random();
  let acc=0;
  for (const m of CONFIG.modifiers) {
    acc += m.weight;
    if (r <= acc) return m;
  }
  return CONFIG.modifiers[CONFIG.modifiers.length-1];
}

function computeDamage(base, mod, defenderShieldUsed, defenderHasShield) {
  let final = base;
  if (mod.effect === "plus1") final += 1;
  if (mod.effect === "crit")  final = base * 2;
  if (mod.effect === "miss")  final = 0;
  if (mod.effect === "null")  final = base; // no change

  let applied = final;
  let shieldConsumed = false;

  if (final > 0 && defenderHasShield && !defenderShieldUsed) {
    const block = CONFIG.modules.shield.block;
    applied = Math.max(0, final - block);
    shieldConsumed = true;
  }
  return { final, applied, shieldConsumed };
}

function applyDamage(module, amount) {
  if (amount <= 0 || !module.alive) return;
  module.hp = Math.max(0, module.hp - amount);
  if (module.hp === 0) module.alive = false;
}

/* ==============================
   AI Targeting
============================== */
function chooseAiTarget() {
  const priorities = CONFIG.aiPriority;
  for (const pType of priorities) {
    const cands = state.you.filter(m => m.type === pType && alive(m));
    if (cands.length) {
      // within type, prefer lowest HP to finish kills
      cands.sort((a,b)=>a.hp-b.hp);
      return cands[0];
    }
  }
  // fallback any alive
  return state.you.find(alive);
}

/* ==============================
   Helpers & DOM
============================== */
function alive(m){ return m && m.alive; }
function uid(){ return Math.random().toString(36).slice(2,9); }
function $(q){ return document.querySelector(q); }
function el(tag, cls="", text=""){ const e=document.createElement(tag); if(cls) e.className=cls; if(text!==undefined) e.textContent=text; return e; }
function pill(text){ const s=el("span","pill"); s.textContent=text; return s; }

function log(msg) {
  const time = new Date().toLocaleTimeString();
  $("#log").innerHTML += `[${time}] ${msg}<br/>`;
  $("#log").scrollTop = $("#log").scrollHeight;
}
function clearLog(){ $("#log").textContent = ""; }

/* ==============================
   Wire up UI
============================== */
$("#endTurnBtn").addEventListener("click", ()=> {
  if (state.turn === "you") {
    endTurnTo("ai");
    setTimeout(aiTurn, CONFIG.betweenTurnsDelayMs);
  }
});
$("#newRoundBtn").addEventListener("click", newRound);
$("#resetBtn").addEventListener("click", resetGame);

/* boot */
resetGame();
</script>
</body>
</html>